<!DOCTYPE html>
<html>

<head>
    <title>Currency Formatting Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h1>Currency Input Formatting Test</h1>
        <p>Test the currency formatting functions with various inputs.</p>

        <form id="testForm" class="mt-4">
            <div class="form-group mb-3">
                <label for="unitPrice" class="form-label">Unit Price ($)</label>
                <input type="text" class="form-control currency-input" id="unitPrice" name="unit_price"
                    placeholder="Enter amount with or without commas (e.g., 1000 or 1,000.50)">
                <small class="form-text text-muted">Try: 1000, 1000.50, 1,000, 1,000.50, etc.</small>
            </div>

            <div class="form-group mb-3">
                <label for="capitalCost" class="form-label">Capital Acquisition Cost ($)</label>
                <input type="text" class="form-control currency-input" id="capitalCost" name="capital_cost"
                    placeholder="Enter amount">
                <small class="form-text text-muted">Try: 5000, 5000.00, 5,000.00, etc.</small>
            </div>

            <button type="button" class="btn btn-primary" onclick="testFormatting()">Test Formatting</button>
            <button type="submit" class="btn btn-success ms-2">Submit Form</button>
        </form>

        <div id="results" class="mt-4"></div>
    </div>

    <script>
        // Copy the JavaScript functions from rfpo_edit.html
        function formatCurrencyDisplay(value) {
            // Remove any non-numeric characters except decimal point
            const cleanValue = value.replace(/[^\d.]/g, '');
            if (!cleanValue) return '';

            // Parse the value
            const numValue = parseFloat(cleanValue);
            if (isNaN(numValue)) return '';

            // Format with comma separator and 2 decimal places
            return numValue.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function cleanCurrencyValue(value) {
            // Remove all commas and non-numeric characters except decimal point
            return value.replace(/[^\d.]/g, '');
        }

        // Initialize currency inputs
        document.addEventListener('DOMContentLoaded', function () {
            // Get all currency input fields
            const currencyInputs = document.querySelectorAll('.currency-input');

            currencyInputs.forEach(input => {
                // On focus: show clean value
                input.addEventListener('focus', function () {
                    const cleanValue = cleanCurrencyValue(this.value);
                    this.value = cleanValue;
                });

                // On input: allow user typing (don't format while typing)
                input.addEventListener('input', function () {
                    // Just validate it's a valid number pattern
                    const cleanValue = cleanCurrencyValue(this.value);
                    // Store clean value in data attribute for submission
                    this.setAttribute('data-clean-value', cleanValue);
                });

                // On blur: format for display
                input.addEventListener('blur', function () {
                    if (this.value) {
                        const cleanValue = cleanCurrencyValue(this.value);
                        if (cleanValue && !isNaN(parseFloat(cleanValue))) {
                            this.value = formatCurrencyDisplay(cleanValue);
                            this.setAttribute('data-clean-value', cleanValue);
                        } else {
                            this.value = '';
                            this.setAttribute('data-clean-value', '');
                        }
                    }
                });
            });

            // Handle form submission - replace formatted values with clean numeric values
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function (e) {
                    e.preventDefault();

                    const currencyInputs = this.querySelectorAll('.currency-input');
                    const results = [];

                    currencyInputs.forEach(input => {
                        // Replace the formatted value with clean numeric value before submission
                        const cleanValue = cleanCurrencyValue(input.value);
                        const originalValue = input.value;
                        input.value = cleanValue;
                        results.push(`<p><strong>${input.name}:</strong> Input="${originalValue}" → Submitted="${cleanValue}"</p>`);
                    });

                    document.getElementById('results').innerHTML = '<div class="alert alert-info"><strong>Form Submission Result:</strong>' + results.join('') + '</div>';
                });
            });
        });

        function testFormatting() {
            const testCases = [
                { input: '1000', expected: '1,000.00' },
                { input: '1000.50', expected: '1,000.50' },
                { input: '1,000', expected: '1,000.00' },
                { input: '1,000.50', expected: '1,000.50' },
                { input: '5000000', expected: '5,000,000.00' },
                { input: '$1000', expected: '1,000.00' },
                { input: '', expected: '' }
            ];

            let results = '<div class="alert alert-success"><strong>Test Results:</strong><ul>';
            testCases.forEach(test => {
                const result = formatCurrencyDisplay(test.input);
                const pass = result === test.expected ? '✓' : '✗';
                results += `<li>${pass} Input: "${test.input}" → Output: "${result}" (Expected: "${test.expected}")</li>`;
            });
            results += '</ul></div>';

            document.getElementById('results').innerHTML = results;
        }
    </script>
</body>

</html>